<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqls>
<sqls>
<!-- sl：检索商品分类 -->
	<sql id="searchproducttype">
SELECT DISTINCT
	"商品種別" as value,
	substr("商品種別",4) as text
FROM
	"MST_出品マスタ情報" 
WHERE
	"length" ( 商品種別 ) > 0 
	AND "店舗ID" = :shopId 
ORDER BY
	"商品種別"
	</sql>
<!-- sl：检索商品番号 -->
<sql id="searchproducno">
SELECT DISTINCT
	"商品管理番号" AS value,
	"商品管理番号" AS text 
FROM
	"MST_出品マスタ情報" 
WHERE
	"length" ( 商品管理番号 ) > 0 
	AND "店舗ID" = :shopId  
ORDER BY
	"商品管理番号"
</sql>
<!-- sl：检索商品总结 -->
<sql id="selectmasterinfo" >
	SELECT DISTINCT
		  "商品種別" as type
		, "商品管理番号" as no
		, "親子区分" as preproduct

		, "分類１" as sub1
		, "分類２" as sub2
		, "ASIN番号" as asin
		
		, "SKU番号" as sku
		, "LABEL番号" as label
		, "仕入価格" as price
		, "仕入申報価格（元）" as price2
		, "仕入申報価格（ドル）" as price3
		, "FBA発送方式" as fba
		, "商品名称" as name
		,"暫定フラグ" as flg

	FROM
		"MST_出品マスタ情報" 
	WHERE
	1=1
 	<if exists="productno"> AND (
				<if istrue="productno == 'マスタ未登録'"> "商品管理番号" is NULL </if>
				<if istrue="productno != 'マスタ未登録'"> "商品管理番号" = :productno </if>
			    )
	</if>

	<if exists="keyword"> AND (
		UPPER("商品種別") LIKE concat('%', :keyword ,'%') OR
		UPPER("商品管理番号") LIKE concat('%', :keyword ,'%') OR
		UPPER("親子区分") LIKE concat('%', :keyword ,'%') OR

		UPPER("分類１") LIKE concat('%', :keyword ,'%') OR
		UPPER("分類２") LIKE concat('%', :keyword ,'%') OR
		UPPER("SKU番号") LIKE concat('%', :keyword ,'%') OR

		UPPER("ASIN番号") LIKE concat('%', :keyword ,'%') OR
		UPPER("LABEL番号") LIKE concat('%', :keyword ,'%')OR
		UPPER("FBA発送方式") LIKE concat('%', :keyword ,'%') OR
		UPPER("商品名称") LIKE concat('%', :keyword ,'%')
			    )
		</if>

	 <if exists="ptype"> AND (	
		  "商品種別" IN (@ptype  )
		)
	 </if>
		AND "店舗ID" = :shopid  
	ORDER BY "商品管理番号","親子区分","分類１","分類２"
</sql>

<!-- sl：设置登录时间 -->
<sql id="logintime" paramPrefix="!">
		UPDATE "MST_出品マスタ情報" 
		SET
		   "登録日時"=now()
		WHERE 
		  "店舗ID" =!shopid
</sql>

<!-- sl：新规 -->
<sql id="savemasterinfo">
	INSERT INTO "MST_出品マスタ情報"
	(
	"SKU番号",
	"ASIN番号",
	"LABEL番号",
	"商品管理番号",
	"親子区分",
	"商品種別",
	"分類１",
	"分類２",
	"仕入価格",
	"FBA発送方式",
	"商品名称",
	"仕入申報価格（元）",
	"仕入申報価格（ドル）",
	"暫定フラグ",
	"店舗ID",
	"更新日時"
	)
	VALUES (
			:sku,--SKU番号
			:asin,--ASIN番号
			:label,--LABEL番号

			:no,--商品管理番号
			:preproduct,--親子区分
			:type,--商品種別

			:sub1,--分類１
			:sub2,--分類２
			cast (:price1 as numeric(10,2)), --仕入価格

			:fba,--FBA発送方式
			:productname,--商品名称
			cast (:price2 as numeric(10,2)),--仕入申報価格（元）

			cast (:price3 as numeric(10,2)), --仕入申報価格（ドル）
			:flg,--暫定フラグ
			:shopid,--店舗ID

			now() --更新日時
		)
</sql>

<!-- sl：更新暂定 -->
<sql id="udatemasterinfoflg1" paramPrefix="!">
		UPDATE "MST_出品マスタ情報" 
		SET
			"SKU番号" = !sku,
			"ASIN番号" = !asin,
			"LABEL番号" = !label,
			"商品管理番号" = !no,
			"親子区分" = !preproduct,
			"商品種別" = !type,
			"分類１" = !sub1,

			"分類２" = !sub2,
			"FBA発送方式" = !fba,
			"商品名称" = !productname,

			"暫定フラグ" = '0',
		    "更新日時"=now()
		WHERE 
		    "店舗ID" =!shopid
		AND 
		    "商品管理番号" = !oldproductno
		AND 
		    "親子区分" = !oldpre
	 
	 	<if exists="oldsub1"> AND (	
		  "分類１" = !oldsub1
		)
	    </if>
	   <if notexists="oldsub1"> AND (	
		  "分類１" is NULL
		)
	   </if>
	    <if exists="oldsub2"> AND (	
		  "分類２" = !oldsub2
		)
	    </if>
	    <if notexists="oldsub2"> AND (	
		  "分類２" is NULL
		)
	     </if>
		   
</sql>
<!-- sl：更新非暂定 -->
<sql id="udatemasterinfoflg0" paramPrefix="!">
		UPDATE "MST_出品マスタ情報" 
		SET
			 
			
			"親子区分" = !preproduct,
			"商品種別" = !type,
			"分類１" = !sub1,

			"分類２" = !sub2,
			"FBA発送方式" = !fba,
			"商品名称" = !productname,

			"暫定フラグ" = !flg,
		    "更新日時"=now()
		WHERE 
		  "店舗ID" =!shopid
		AND 
		  "SKU番号" = !sku
		AND 	
		  "ASIN番号" = !asin
</sql>

<!-- sl：更新仕入価格 -->
<sql id="udatemasterinfosub"  >
		UPDATE "MST_出品マスタ情報" 
		SET
		   "仕入価格" =  cast(:price1 as numeric(10,2)),
			"仕入申報価格（元）" = cast(:price2 as numeric(10,2)),
			"仕入申報価格（ドル）" = cast(:price3 as numeric(10,2))

		WHERE 
		  "店舗ID" =:shopid
		AND 
		  "商品管理番号" = :no
		AND 
		  "親子区分" != :preproduct
</sql>

<!-- sl：ASIN,SKU,LABEL查询 -->
<sql id="searchASL" >
SELECT 
	      "ASIN番号" as asin
		, "SKU番号" as sku
		, "LABEL番号" as label
FROM
	"MST_出品マスタ情報" 
WHERE
	 "商品管理番号" is NULL

	</sql>
</sqls>

